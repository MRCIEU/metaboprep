---
output: github_document
---

<!-- README.md is generated from README.Rmd. Please edit that file -->

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.path = "man/figures/README-",
  out.width = "100%"
)
```

# metaboprep
<!-- badges: start -->
[![Lifecycle: experimental](https://img.shields.io/badge/lifecycle-experimental-orange.svg)](https://lifecycle.r-lib.org/articles/stages.html#experimental)
<!-- badges: end -->

<!-- <div style="text-align: center"> -->
<!--   <img src="man/figures/logo.png" alt="metaboprep logo" width="150"/>  -->
<!-- </div> -->


The goal of `metaboprep` is to:  

1. Read in and processes (un)targeted metabolite data, saving datasets in tab-delimited format for use elsewhere
2. Provide useful summary data in the form of tab-delimited text file and a html report.  
3. Perform data filtering on the data set using a standard pipeline and according to user-defined thresholds.  


## Installation

You can install the development version of metaboprep from [GitHub](https://github.com/MRCIEU/metaboprep/tree/v2_development) with:

``` r
# install.packages("pak")
pak::pak("MRCIEU/metaboprep")
```

## Cheatsheet
![Cheatsheet](man/figures/cheatsheet.png)


## Example

This is a basic example which shows you how to load data and run the `metaboprep` quality control pipeline.

### Read data into R and create the Metaboprep object

```{r}
library(metaboprep)

# import data 
m <- read_metabolon(system.file("extdata", "metabolon_v1.1_example.xlsx", package = "metaboprep"), 
                    sheet = "OrigScale",      ## The name of the sheet in the excel file to read in
                    return_Metaboprep = TRUE  ## Whether to return a Metaboprep object (TRUE) or a list (FALSE)
                    )

```

### Run the quality control pipeline

```{r example}
# run QC
m <- suppressWarnings( quality_control(m, source_layer = "input", 
                  sample_missingness  = 0.2, 
                  feature_missingness = 0.2, 
                  total_peak_area_sd  = 5, 
                  outlier_udist       = 5, 
                  outlier_treatment   = "leave_be", 
                  winsorize_quantile  = 1.0, 
                  tree_cut_height     = 0.5, 
                  pc_outlier_sd       = 5, 
                  sample_ids          = NULL, 
                  feature_ids         = NULL) )
```

### View a summary of the Metaboprep object

```{r summary}
# view summary
summary(m)
```

### Plot a dendrogram of the feature tree

```{r treeplot, fig.alt = "Dendrogram", fig.width = 20, fig.height = 5}
# view feature tree
tree <- attr(m@feature_summary, "qc_tree")
par(mar = c(1,3,5,1) )
plot(tree, hang = -1, cex = 0.75, main = "Example Dataset Feature Tree", sub = "", xlab = "")
```

